---
title: "naCountOnMerge"
author: "Siwanart Ma"
date: "2024-12-20"
output:
  pdf_document: default
  html_document: default
---
Initial setting up
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "/scratch_tmp/grp/msc_appbio/DCDM_group6/")
getwd()
```

read the merged csv file
```{r}
df = read.csv("/scratch_tmp/grp/msc_appbio/DCDM_group6/outputs/tables/Merged_df_final.csv")
df = df[, -1]
head(df)
```
Count NA values in each column
```{r}
na_counts = colSums(is.na(df))
print(na_counts)
```
Read sop
```{r}
sop = read.csv("/scratch_tmp/grp/msc_appbio/DCDM_group6/metadata/IMPC_SOP.csv")
sop
```

Set the ranges
```{r}
allFields = sop[,1]
allMins = sop[,3]
allMaxs = sop[,4]
print(allFields)
print(allMins)
print(allMaxs)
```

Count how many NA values are there in each row
```{r}
# Identify String and p-value columns based on SOP
string_columns <- allFields[sop$dataType == "String"]
pvalue_columns <- allFields[sop$dataType != "String"]

# Filter for valid columns in df
string_columns <- intersect(string_columns, colnames(df))
pvalue_columns <- intersect(pvalue_columns, colnames(df))

# Create a data frame to store NA counts
na_counts <- data.frame(
  analysis_id = if ("analysis_id" %in% colnames(df)) df$analysis_id else seq_len(nrow(df)),
  na_count_string = rowSums(is.na(df[string_columns])),
  na_count_pvalue = rowSums(is.na(df[pvalue_columns]))
)

# Filter rows where total NA count is greater than 1
filtered_na_counts <- na_counts[
  na_counts$na_count_string + na_counts$na_count_pvalue > 1, 
]

# Output the filtered data frame
print(head(filtered_na_counts))
```
How many data have at least 1 NA 
```{r}
print(nrow(filtered_na_counts))
```
```
